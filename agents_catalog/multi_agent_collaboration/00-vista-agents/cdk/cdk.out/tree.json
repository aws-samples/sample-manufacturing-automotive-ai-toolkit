{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.206.0"},"children":{"VistaServiceStack":{"id":"VistaServiceStack","path":"VistaServiceStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.206.0"},"children":{"VistaResourceBucket":{"id":"VistaResourceBucket","path":"VistaServiceStack/VistaResourceBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/VistaResourceBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketName":"vista-service-resources-us-west-2-149536462911","tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"}]}}},"Policy":{"id":"Policy","path":"VistaServiceStack/VistaResourceBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/VistaResourceBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"VistaResourceBucket027FF1B1"},"policyDocument":{"Statement":[{"Action":["s3:DeleteObject*","s3:GetBucket*","s3:List*","s3:PutBucketPolicy"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["VistaResourceBucket027FF1B1","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["VistaResourceBucket027FF1B1","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"VistaServiceStack/VistaResourceBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.206.0","metadata":[]},"children":{"Default":{"id":"Default","path":"VistaServiceStack/VistaResourceBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.206.0"}}}}}},"Custom::S3AutoDeleteObjectsCustomResourceProvider":{"id":"Custom::S3AutoDeleteObjectsCustomResourceProvider","path":"VistaServiceStack/Custom::S3AutoDeleteObjectsCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResourceProviderBase","version":"2.206.0"},"children":{"Staging":{"id":"Staging","path":"VistaServiceStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.206.0"}},"Role":{"id":"Role","path":"VistaServiceStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.206.0"}},"Handler":{"id":"Handler","path":"VistaServiceStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.206.0"}}}},"Dealer_DataTable":{"id":"Dealer_DataTable","path":"VistaServiceStack/Dealer_DataTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/Dealer_DataTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"dealer_code","attributeType":"S"},{"attributeName":"city_name","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"dealer_code","keyType":"HASH"},{"attributeName":"city_name","keyType":"RANGE"}],"tableName":"dealer-data"}}},"ScalingRole":{"id":"ScalingRole","path":"VistaServiceStack/Dealer_DataTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.206.0","metadata":[]}}}},"Dealer_Appointment_DataTable":{"id":"Dealer_Appointment_DataTable","path":"VistaServiceStack/Dealer_Appointment_DataTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/Dealer_Appointment_DataTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"dealer_name","attributeType":"S"},{"attributeName":"appointment_date_time","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"dealer_name","keyType":"HASH"},{"attributeName":"appointment_date_time","keyType":"RANGE"}],"tableName":"dealer-appointment-data"}}},"ScalingRole":{"id":"ScalingRole","path":"VistaServiceStack/Dealer_Appointment_DataTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.206.0","metadata":[]}}}},"Customer_User_ProfileTable":{"id":"Customer_User_ProfileTable","path":"VistaServiceStack/Customer_User_ProfileTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/Customer_User_ProfileTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"customer_id","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"customer_id","keyType":"HASH"}],"tableName":"customer-user-profile"}}},"ScalingRole":{"id":"ScalingRole","path":"VistaServiceStack/Customer_User_ProfileTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.206.0","metadata":[]}}}},"Dtc_Parts_LookupTable":{"id":"Dtc_Parts_LookupTable","path":"VistaServiceStack/Dtc_Parts_LookupTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/Dtc_Parts_LookupTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"dtc_code","attributeType":"S"},{"attributeName":"part_code","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"dtc_code","keyType":"HASH"},{"attributeName":"part_code","keyType":"RANGE"}],"tableName":"dtc-parts-lookup"}}},"ScalingRole":{"id":"ScalingRole","path":"VistaServiceStack/Dtc_Parts_LookupTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.206.0","metadata":[]}}}},"Dealer_Parts_StockTable":{"id":"Dealer_Parts_StockTable","path":"VistaServiceStack/Dealer_Parts_StockTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/Dealer_Parts_StockTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"dealer_code","attributeType":"S"},{"attributeName":"part_code","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"dealer_code","keyType":"HASH"},{"attributeName":"part_code","keyType":"RANGE"}],"tableName":"dealer-parts-stock"}}},"ScalingRole":{"id":"ScalingRole","path":"VistaServiceStack/Dealer_Parts_StockTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.206.0","metadata":[]}}}},"Dealer_Parts_OrderTable":{"id":"Dealer_Parts_OrderTable","path":"VistaServiceStack/Dealer_Parts_OrderTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/Dealer_Parts_OrderTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"dealer_code","attributeType":"S"},{"attributeName":"part_code","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"dealer_code","keyType":"HASH"},{"attributeName":"part_code","keyType":"RANGE"}],"tableName":"dealer-parts-order"}}},"ScalingRole":{"id":"ScalingRole","path":"VistaServiceStack/Dealer_Parts_OrderTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.206.0","metadata":[]}}}},"Warranty_InfoTable":{"id":"Warranty_InfoTable","path":"VistaServiceStack/Warranty_InfoTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/Warranty_InfoTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"VIN","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"VIN","keyType":"HASH"}],"tableName":"warranty-info"}}},"ScalingRole":{"id":"ScalingRole","path":"VistaServiceStack/Warranty_InfoTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.206.0","metadata":[]}}}},"VistaLambdaExecutionRole":{"id":"VistaLambdaExecutionRole","path":"VistaServiceStack/VistaLambdaExecutionRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.206.0","metadata":[]},"children":{"ImportVistaLambdaExecutionRole":{"id":"ImportVistaLambdaExecutionRole","path":"VistaServiceStack/VistaLambdaExecutionRole/ImportVistaLambdaExecutionRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.206.0","metadata":[]}},"Resource":{"id":"Resource","path":"VistaServiceStack/VistaLambdaExecutionRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonDynamoDBFullAccess"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"VistaServiceStack/VistaLambdaExecutionRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/VistaLambdaExecutionRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["bedrock:InvokeAgent","bedrock:InvokeModel"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"VistaLambdaExecutionRoleDefaultPolicy89C8C35C","roles":[{"Ref":"VistaLambdaExecutionRole67057059"}]}}}}}}},"BusinessLogicGet_Dealer_DataFunction":{"id":"BusinessLogicGet_Dealer_DataFunction","path":"VistaServiceStack/BusinessLogicGet_Dealer_DataFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/BusinessLogicGet_Dealer_DataFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["arm64"],"code":{"zipFile":"import boto3\nimport json\nfrom decimal import Decimal\nfrom boto3.dynamodb.conditions import Attr\n\nclass DecimalEncoder(json.JSONEncoder):\n    def default(self, o):\n        if isinstance(o, Decimal):\n            return float(o)\n        return super(DecimalEncoder, self).default(o)\n\ndef lambda_handler(event, context):\n    \n    if \"parameters\" in event:\n        # Loop through the parameters list to find the city\n        city = \"\"\n        for param in event[\"parameters\"]:\n            if param.get(\"name\") == \"city\":\n                city = param.get(\"value\", \"\")\n                break\n    else:\n        city = event.get(\"city\", \"\")\n    \n    agent = event['agent']\n    function = event['function']\n    actionGroup = event['actionGroup']\n\n    # Normalize the city name to match stored format (e.g., \"San Francisco\")\n    city = city.title()\n\n    dynamodb = boto3.resource('dynamodb')\n    table = dynamodb.Table('dealer-data')\n    \n    try:\n        response = table.scan(\n            FilterExpression=Attr(\"city_name\").eq(city)\n        )\n        items = response.get(\"Items\", [])\n\n    except Exception as e:\n        # Capture DynamoDB error and return it to the caller\n        error_message = f\"Error querying DynamoDB: {str(e)}\"\n        print(error_message)\n        \n        # Create error response\n        response_body = {\n            'TEXT': {\n                'body': json.dumps({\"error\": error_message})\n            }\n        }\n        \n        function_response = {\n            'actionGroup': event['actionGroup'],\n            'function': event['function'],\n            'functionResponse': {\n                'responseBody': response_body\n            }\n        }\n        \n        return {\n            'messageVersion': '1.0', \n            'response': function_response,\n            'sessionAttributes': event['sessionAttributes'],\n            'promptSessionAttributes': event['promptSessionAttributes']\n        }\n    \n    # Check if any dealers were found\n    if not items:\n        # No dealers found, return a message\n        output = [{\"message\": f\"No dealers found in {city}\"}]\n        print('No dealers found')\n    else:\n        # Dealers found, process them\n        output = []\n        for item in items:\n            output.append({\n                \"dealer_code\": item.get(\"dealer_code\"),\n                \"dealer_name\": item.get(\"dealer_name\"),\n                \"latitude\": item.get(\"latitude\"),\n                \"longitude\": item.get(\"longitude\"),\n                \"city_name\": item.get(\"city_name\"),\n                \"website\": item.get(\"website\"),\n                \"street\": item.get(\"street\"),\n                \"city\": item.get(\"city\"),\n                \"state\": item.get(\"state\"),\n                \"country\": item.get(\"country\"),\n                \"zip\": item.get(\"zip\"),\n                \"phone\": item.get(\"phone\"),\n                \"email\": item.get(\"email\")\n            })\n    \n    response_body = {\n        'TEXT': {\n            'body': json.dumps(output, cls=DecimalEncoder)\n        }\n    }\n\n    function_response = {\n        'actionGroup': event['actionGroup'],\n        'function': event['function'],\n        'functionResponse': {\n            'responseBody': response_body\n        }\n    }\n    \n    session_attributes = event['sessionAttributes']\n    prompt_session_attributes = event['promptSessionAttributes']\n    \n    action_response = {\n        'messageVersion': '1.0', \n        'response': function_response,\n        'sessionAttributes': session_attributes,\n        'promptSessionAttributes': prompt_session_attributes\n    }\n    \n    print (action_response)\n    return action_response\n"},"environment":{"variables":{"TABLE_NAME":{"Ref":"DealerDataTableE4DC8147"}}},"functionName":"get-dealer-data","handler":"index.lambda_handler","memorySize":512,"role":{"Fn::GetAtt":["VistaLambdaExecutionRole67057059","Arn"]},"runtime":"python3.13","timeout":600}}},"BedrockInvokePermissionBusinessLogicGet_Dealer_DataFunction":{"id":"BedrockInvokePermissionBusinessLogicGet_Dealer_DataFunction","path":"VistaServiceStack/BusinessLogicGet_Dealer_DataFunction/BedrockInvokePermissionBusinessLogicGet_Dealer_DataFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["BusinessLogicGetDealerDataFunction103CF50F","Arn"]},"principal":"bedrock.amazonaws.com"}}}}},"BusinessLogicGet_Dealer_Appointment_SlotsFunction":{"id":"BusinessLogicGet_Dealer_Appointment_SlotsFunction","path":"VistaServiceStack/BusinessLogicGet_Dealer_Appointment_SlotsFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/BusinessLogicGet_Dealer_Appointment_SlotsFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["arm64"],"code":{"zipFile":"import boto3\nimport json\nfrom boto3.dynamodb.conditions import Attr\nfrom datetime import datetime, timedelta\nfrom boto3.dynamodb.conditions import Key\n\n# Define available time slots\nAVAILABLE_SLOTS = [\"08:00 AM\", \"10:00 AM\", \"12:00 PM\", \"02:00 PM\", \"04:00 PM\"]\n\ndef get_next_business_day(start_date=None):\n    \"\"\"Get the next business day from the given start_date (or today +1 if None), skipping weekends.\"\"\"\n    if start_date:\n        next_day = datetime.strptime(start_date, \"%Y-%m-%d\") + timedelta(days=1)\n    else:\n        next_day = datetime.now() + timedelta(days=1)\n\n    while next_day.weekday() >= 5:  # 5 = Saturday, 6 = Sunday\n        next_day += timedelta(days=1)\n    \n    return next_day.strftime(\"%Y-%m-%d\")\n\ndef format_dealer_name(dealer_name):\n    \"\"\"Format dealer name with first letter of each word capitalized.\"\"\"\n    if not dealer_name:\n        return dealer_name\n    # Split by spaces and capitalize first letter of each word\n    words = dealer_name.split()\n    formatted_name = ' '.join(word.capitalize() for word in words)\n    return formatted_name\n\ndef get_booked_appointments(dealer_name, appointment_date, appointment_table):\n    \"\"\"Scan DynamoDB to get booked appointments for a given dealer name and date.\"\"\"\n    # Format dealer name to match the format in DynamoDB\n    formatted_dealer_name = format_dealer_name(dealer_name)\n    \n    response = appointment_table.scan(\n        FilterExpression=Attr(\"dealer_name\").eq(formatted_dealer_name) & Attr(\"appointment_date_time\").begins_with(appointment_date)\n    )\n\n    return {item[\"appointment_date_time\"][11:] for item in response.get(\"Items\", [])}\n\ndef find_available_slots_for_date(dealer_name, appointment_date, appointment_table):\n    \"\"\"Find available appointment slots for a specific date.\"\"\"\n    booked_slots = get_booked_appointments(dealer_name, appointment_date, appointment_table)\n    \n    # Find slots that are not booked for the specified date\n    available_slots = [\n        (appointment_date, slot) for slot in AVAILABLE_SLOTS \n        if slot not in booked_slots\n    ]\n    \n    # Return available slots for the requested date (may be empty)\n    return available_slots\n\ndef find_available_slots(dealer_name, appointment_table):\n    \"\"\"Find 5 available appointment slots, searching across multiple days if needed.\"\"\"\n    slots_found = []\n    search_date = get_next_business_day()\n    \n    while len(slots_found) < 5:\n        booked_slots = get_booked_appointments(dealer_name, search_date, appointment_table)\n        \n        # Find slots that are not booked\n        available_slots = [\n            (search_date, slot) for slot in AVAILABLE_SLOTS \n            if slot not in booked_slots\n        ]\n        \n        if available_slots:\n            slots_needed = 5 - len(slots_found)\n            slots_found.extend(available_slots[:slots_needed])\n\n        # Move to the next business day if we haven't found enough slots\n        if len(slots_found) < 5:\n            search_date = get_next_business_day(search_date)\n\n    return slots_found\n\ndef get_dealer_details(dealer_name):\n    \"\"\"Get dealer details from the dealer-data table.\"\"\"\n    dynamodb = boto3.resource(\"dynamodb\")\n    dealer_table = dynamodb.Table(\"dealer-data\")\n    \n    # Format dealer name to match the format in DynamoDB\n    formatted_dealer_name = format_dealer_name(dealer_name)\n    \n    response = dealer_table.scan(\n        FilterExpression=Attr(\"dealer_name\").eq(formatted_dealer_name)\n    )\n    \n    items = response.get(\"Items\", [])\n    if not items:\n        return None\n    \n    dealer = items[0]\n    return {\n        \"name\": dealer.get(\"dealer_name\"),\n        \"website\": dealer.get(\"website\"),\n        \"address\": f\"{dealer.get('street')} {dealer.get('city')} {dealer.get('state')} {dealer.get('zip')} {dealer.get('country')}\",\n        \"street\": dealer.get(\"street\"),\n        \"city\": dealer.get(\"city\"),\n        \"state\": dealer.get(\"state\"),\n        \"country\": dealer.get(\"country\"),\n        \"zip\": dealer.get(\"zip\"),\n        \"contactDetails\": dealer.get(\"phone\"),\n        \"addressTitle\": f\"{dealer.get('city')} AutoMall\"\n    }\n\ndef format_time_for_response(time_str):\n    \"\"\"Return the time string in its original format.\"\"\"\n    # Return the original time string instead of converting to 24-hour format\n    return time_str\n\ndef get_day_of_week(date_str):\n    \"\"\"Get the day of week from a date string.\"\"\"\n    date_obj = datetime.strptime(date_str, \"%Y-%m-%d\")\n    return date_obj.strftime(\"%A\")\n\ndef lambda_handler(event, context):\n    dynamodb = boto3.resource(\"dynamodb\")\n    appointment_table = dynamodb.Table(\"dealer-appointment-data\") \n    \n    print(event)\n\n    agent = event.get('agent', 'unknown')\n    function = event.get('function', 'unknown')\n    actionGroup = event.get('actionGroup', 'unknown')\n\n    # Extract the dealer name and appointment date from the 'parameters' list in the JSON\n    dealer_name = None\n    appointment_date = None\n    if \"parameters\" in event:\n        for param in event.get('parameters', []):\n            if param.get('name') == 'dealer_name' or \\\n               param.get('name') == 'dealername':\n                dealer_name = param.get('value')\n            elif param.get('name') == 'appointment_date':\n                appointment_date = param.get('value')\n                break\n    else:\n        dealer_name = event.get(\"dealer_name\") or event.get(\"dealername\")\n\n    if not dealer_name:\n        return {\"statusCode\": 400, \"body\": json.dumps({\"error\": \"Missing dealer_name\"})}\n\n    # Get dealer details\n    dealer_details = get_dealer_details(dealer_name)\n    if not dealer_details:\n        response_body = {\n            'TEXT': {\n                'body': json.dumps({\n                    \"message\": f\"We could not find a dealer with the name '{dealer_name}'. Please check the dealer name and try again.\"\n                }, indent=2)\n            }\n        }\n        \n        function_response = {\n            'actionGroup': actionGroup,\n            'function': function,\n            'functionResponse': {\n                'responseBody': response_body\n            }\n        }\n        \n        session_attributes = event.get('sessionAttributes', {})\n        prompt_session_attributes = event.get('promptSessionAttributes', {})\n        \n        action_response = {\n            'messageVersion': '1.0', \n            'response': function_response,\n            'sessionAttributes': session_attributes,\n            'promptSessionAttributes': prompt_session_attributes\n        }\n        \n        print(action_response)\n        return action_response\n\n    # Validate appointment date if provided\n    if appointment_date:\n        # Check if appointment date is today or in the past\n        today = datetime.now().strftime(\"%Y-%m-%d\")\n        if appointment_date <= today:\n            response_body = {\n                'TEXT': {\n                    'body': json.dumps({\n                        \"message\": \"We cannot find appointment slots for today or past dates.\"\n                    }, indent=2)\n                }\n            }\n            \n            function_response = {\n                'actionGroup': actionGroup,\n                'function': function,\n                'functionResponse': {\n                    'responseBody': response_body\n                }\n            }\n            \n            session_attributes = event.get('sessionAttributes', {})\n            prompt_session_attributes = event.get('promptSessionAttributes', {})\n            \n            action_response = {\n                'messageVersion': '1.0', \n                'response': function_response,\n                'sessionAttributes': session_attributes,\n                'promptSessionAttributes': prompt_session_attributes\n            }\n            \n            print(action_response)\n            return action_response\n            \n        available_slots = find_available_slots_for_date(dealer_name, appointment_date, appointment_table)\n        if not available_slots:\n            # Format the date for display (assuming appointment_date is in YYYY-MM-DD format)\n            formatted_date = datetime.strptime(appointment_date, \"%Y-%m-%d\").strftime(\"%m-%d-%Y\")\n            response_body = {\n                'TEXT': {\n                    'body': json.dumps({\n                        \"message\": f\"There are no available slots for the date {formatted_date}\"\n                    }, indent=2)\n                }\n            }\n            \n            function_response = {\n                'actionGroup': actionGroup,\n                'function': function,\n                'functionResponse': {\n                    'responseBody': response_body\n                }\n            }\n            \n            session_attributes = event.get('sessionAttributes', {})\n            prompt_session_attributes = event.get('promptSessionAttributes', {})\n            \n            action_response = {\n                'messageVersion': '1.0', \n                'response': function_response,\n                'sessionAttributes': session_attributes,\n                'promptSessionAttributes': prompt_session_attributes\n            }\n            \n            print(action_response)\n            return action_response\n    else:\n        available_slots = find_available_slots(dealer_name, appointment_table)\n    \n    # Check if this is a direct invocation or from Bedrock\n    if all(key in event for key in ['agent', 'function', 'actionGroup']):\n        # Group slots by date\n        slots_by_date = {}\n        for date, time in available_slots:\n            if date not in slots_by_date:\n                slots_by_date[date] = []\n            slots_by_date[date].append(time)\n        \n        # Format the response according to the required structure\n        days = []\n        today = datetime.now().strftime(\"%Y-%m-%d\")\n        \n        for date, times in slots_by_date.items():\n            day_data = {\n                \"isOpen\": True,\n                \"isToday\": date == today,\n                \"calendarDate\": date,\n                \"dayOfWeek\": get_day_of_week(date),\n                \"timeslots\": [\n                    {\n                        \"time\": format_time_for_response(time),\n                        \"isOpen\": True\n                    } for time in times\n                ]\n            }\n            days.append(day_data)\n        \n        # Construct the final response\n        response_data = {\n            \"dealerDetails\": dealer_details,\n            \"availableTimeslots\": {\n                \"days\": days\n            }\n        }\n        \n        response_body = {\n            'TEXT': {\n                'body': json.dumps(response_data, indent=2)\n            }\n        }\n        \n        function_response = {\n            'actionGroup': actionGroup,\n            'function': function,\n            'functionResponse': {\n                'responseBody': response_body\n            }\n        }\n        \n        session_attributes = event.get('sessionAttributes', {})\n        prompt_session_attributes = event.get('promptSessionAttributes', {})\n        \n        action_response = {\n            'messageVersion': '1.0', \n            'response': function_response,\n            'sessionAttributes': session_attributes,\n            'promptSessionAttributes': prompt_session_attributes\n        }\n        \n        print(action_response)\n        return action_response\n    else:\n        # Direct invocation format\n        return {\n            \"statusCode\": 200,\n            \"body\": json.dumps([{\"date\": date, \"time\": time} for date, time in available_slots])\n        }\n"},"environment":{"variables":{"TABLE_NAME":{"Ref":"DealerAppointmentDataTableE5466EB8"}}},"functionName":"get-dealer-appointment-slots","handler":"index.lambda_handler","memorySize":128,"role":{"Fn::GetAtt":["VistaLambdaExecutionRole67057059","Arn"]},"runtime":"python3.13","timeout":10}}},"BedrockInvokePermissionBusinessLogicGet_Dealer_Appointment_SlotsFunction":{"id":"BedrockInvokePermissionBusinessLogicGet_Dealer_Appointment_SlotsFunction","path":"VistaServiceStack/BusinessLogicGet_Dealer_Appointment_SlotsFunction/BedrockInvokePermissionBusinessLogicGet_Dealer_Appointment_SlotsFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["BusinessLogicGetDealerAppointmentSlotsFunction27BA81DF","Arn"]},"principal":"bedrock.amazonaws.com"}}}}},"BusinessLogicBookappointmentFunction":{"id":"BusinessLogicBookappointmentFunction","path":"VistaServiceStack/BusinessLogicBookappointmentFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/BusinessLogicBookappointmentFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["x86_64"],"code":{"zipFile":"import boto3\nimport json\nfrom datetime import datetime\nfrom boto3.dynamodb.conditions import Key, Attr\n\ndef lambda_handler(event, context):\n    dynamodb = boto3.resource(\"dynamodb\")\n    table = dynamodb.Table(\"dealer-appointment-slots\")\n\n    if \"parameters\" in event:\n        # Loop through the parameters list to find the dealer, appointment date, and appointment time\n        dealer_name = \"\"\n        appointment_date = \"\"\n        appointment_time = \"\"\n        for param in event[\"parameters\"]:\n            if param.get(\"name\") == \"dealer_name\":\n                dealer_name = param.get(\"value\", \"\")\n            elif param.get(\"name\") == \"appointment_date\":\n                appointment_date = param.get(\"value\", \"\")\n            elif param.get(\"name\") == \"appointment_time\":\n                appointment_time = param.get(\"value\", \"\")\n    else:\n        dealer_name = event.get(\"dealer_name\")\n        appointment_date = event.get(\"appointment_date\")\n        appointment_time = event.get(\"appointment_time\")\n\n    if not dealer_name or not appointment_date or not appointment_time:\n\n        agent = event['agent']\n        function = event['function']\n        actionGroup = event['actionGroup']\n\n        response_body = {\n            'TEXT': {\n                'body': json.dumps({\n                    \"message\": \"Missing dealer name, appointment date or appointment time\",\n                })\n            }\n        }\n        function_response = {\n            'actionGroup': event['actionGroup'],\n            'function': event['function'],\n            'functionResponse': {\n                'responseBody': response_body\n            }\n        }\n\n        session_attributes = event['sessionAttributes']\n        prompt_session_attributes = event['promptSessionAttributes']\n\n        action_response = {\n            'messageVersion': '1.0', \n            'response': function_response,\n            'sessionAttributes': session_attributes,\n            'promptSessionAttributes': prompt_session_attributes\n        }\n        \n        return action_response\n\n    dealer_table = dynamodb.Table(\"dealer-data\")\n\n    response = dealer_table.query(\n        KeyConditionExpression=Key('dealer_name').eq(dealer_name)\n    )\n    if 'Items' in response and len(response['Items']) == 1:\n        dealer_item = response['Items'][0]  \n        dealer_name = dealer_item.get('dealer_name')\n        print(dealer_name)\n    else:\n        dealer_name = \"Unknown Dealer\"\n\n    agent = event['agent']\n    function = event['function']\n    actionGroup = event['actionGroup']\n\n    try:\n        # First, check if there's an available slot for this dealer, date, and time\n        response = table.scan(\n            FilterExpression=Key('dealer_name').eq(dealer_name) & \n                           Attr('appointment_date').eq(appointment_date) & \n                           Attr('appointment_time').eq(appointment_time) & \n                           Attr('status').eq('available')\n        )\n        \n        available_slots = response.get('Items', [])\n        \n        if not available_slots:\n            response_body = {\n                'TEXT': {\n                    'body': json.dumps({\n                        \"message\": f\"Sorry, no available slot found for {dealer_name} on {appointment_date} at {appointment_time}. Please check available slots first.\"\n                    })\n                }\n            }\n        else:\n            # Book the slot by updating its status\n            slot = available_slots[0]\n            slot_id = slot['slot_id']\n            \n            # Update the slot status to 'booked'\n            table.update_item(\n                Key={'slot_id': slot_id},\n                UpdateExpression='SET #status = :status, customer_info = :customer_info',\n                ExpressionAttributeNames={'#status': 'status'},\n                ExpressionAttributeValues={\n                    ':status': 'booked',\n                    ':customer_info': {\n                        'booked_at': appointment_date_time,\n                        'booking_timestamp': str(datetime.now())\n                    }\n                }\n            )\n            \n            response_body = {\n                'TEXT': {\n                    'body': json.dumps({\n                        \"message\": f\"Appointment successfully booked with {dealer_name} on {appointment_date} at {appointment_time}\",\n                        \"dealer_name\": dealer_name,\n                        \"appointment_date\": appointment_date,\n                        \"appointment_time\": appointment_time\n                    })\n                }\n            }\n        function_response = {\n            'actionGroup': event['actionGroup'],\n            'function': event['function'],\n            'functionResponse': {\n                'responseBody': response_body\n            }\n        }\n\n        session_attributes = event['sessionAttributes']\n        prompt_session_attributes = event['promptSessionAttributes']\n\n        action_response = {\n            'messageVersion': '1.0', \n            'response': function_response,\n            'sessionAttributes': session_attributes,\n            'promptSessionAttributes': prompt_session_attributes\n        }\n        \n        return action_response\n\n    except Exception as e:\n        return {\n            \"statusCode\": 500,\n            \"body\": json.dumps({\"error\": str(e)}),\n            \"headers\": {\"Content-Type\": \"application/json\"}\n        }\n"},"environment":{"variables":{"TABLE_NAME":{"Ref":"DealerAppointmentDataTableE5466EB8"}}},"functionName":"BookAppointment","handler":"index.lambda_handler","memorySize":256,"role":{"Fn::GetAtt":["VistaLambdaExecutionRole67057059","Arn"]},"runtime":"python3.9","timeout":30}}},"BedrockInvokePermissionBusinessLogicBookappointmentFunction":{"id":"BedrockInvokePermissionBusinessLogicBookappointmentFunction","path":"VistaServiceStack/BusinessLogicBookappointmentFunction/BedrockInvokePermissionBusinessLogicBookappointmentFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["BusinessLogicBookappointmentFunctionEB9E5123","Arn"]},"principal":"bedrock.amazonaws.com"}}}}},"BusinessLogicBookappointmentstarFunction":{"id":"BusinessLogicBookappointmentstarFunction","path":"VistaServiceStack/BusinessLogicBookappointmentstarFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/BusinessLogicBookappointmentstarFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["x86_64"],"code":{"zipFile":"import boto3\nimport json\nimport uuid\nfrom boto3.dynamodb.conditions import Key\nfrom boto3.dynamodb.conditions import Attr\n\ndef lambda_handler(event, context):\n    print(f\"Event: {event}\")\n    \n    dynamodb = boto3.resource(\"dynamodb\")\n    dealer_table = dynamodb.Table(\"dealer-data\")\n    user_profiles_table = dynamodb.Table(\"customer-user-profile\")\n\n    # Extract parameters\n    dealer_name = \"\"\n    appointment_date = \"\"\n    appointment_time = \"\"\n    customer_code = \"\"\n    for param in event.get(\"parameters\", []):\n        if param.get(\"name\") == \"dealer_name\":\n            dealer_name = param.get(\"value\", \"\")\n        elif param.get(\"name\") == \"appointment_date\":\n            appointment_date = param.get(\"value\", \"\")\n        elif param.get(\"name\") == \"appointment_time\":\n            appointment_time = param.get(\"value\", \"\")\n        elif param.get(\"name\") == \"customer_code\":\n            customer_code = param.get(\"value\", \"\")\n\n    # Basic validation\n    if not all([dealer_name, appointment_date, appointment_time, customer_code]):\n        agent = event['agent']\n        function = event['function']\n        actionGroup = event['actionGroup']\n\n        response_body = {\n            'TEXT': {\n                'body': json.dumps({\n                    \"message\": \"Missing dealer name, appointment date or appointment time\",\n                })\n            }\n        }\n        function_response = {\n            'actionGroup': event['actionGroup'],\n            'function': event['function'],\n            'functionResponse': {\n                'responseBody': response_body\n            }\n        }\n\n        session_attributes = event['sessionAttributes']\n        prompt_session_attributes = event['promptSessionAttributes']\n\n        action_response = {\n            'messageVersion': '1.0', \n            'response': function_response,\n            'sessionAttributes': session_attributes,\n            'promptSessionAttributes': prompt_session_attributes\n        }\n        \n        return action_response\n\n    # Format dealer name properly (capitalize each word)\n    def format_dealer_name(name):\n        # Special case handling\n        if name.lower() == \"super\":\n            return \"Super\"\n        elif name.lower() == \"apex autos\":\n            return \"Apex Autos\"\n        else:\n            # Default case: capitalize each word\n            return ' '.join(word.capitalize() for word in name.split())\n    \n    # Format the dealer name before querying\n    formatted_dealer_name = format_dealer_name(dealer_name)\n    print(f\"Original dealer name: {dealer_name}, Formatted dealer name: {formatted_dealer_name}\")\n    \n    # Query dealer name    \n    try:\n        dealer_response = dealer_table.scan(\n            FilterExpression=Attr('dealer_name').eq(formatted_dealer_name)\n        )\n        dealer_name = dealer_response['Items'][0].get('dealer_name') if dealer_response['Items'] else \"Unknown Dealer\"\n\n    except Exception as e:\n        print(f\"Error retrieving dealer name: {str(e)}\")\n        dealer_name = \"Unknown Dealer\"\n\n    # Query customer data (customer_id is partition key)\n    try:\n        customer_response = user_profiles_table.query(\n            KeyConditionExpression=Key('customer_id').eq(customer_code)\n        )\n        if not customer_response['Items']:\n            raise ValueError(\"Customer not found\")\n\n        customer_data = customer_response['Items'][0]\n        first_name = customer_data.get('first_name', '')\n        last_name = customer_data.get('last_name', '')\n        contact_method = customer_data.get('contact_method', {})\n        consent = customer_data.get('consent', False)\n        preferred_contact_time = customer_data.get('preferred_contact_time', '')\n        vin = customer_data.get('VIN', '')\n\n        # If contact_method is a JSON string, parse it\n        if isinstance(contact_method, str):\n            try:\n                contact_method = json.loads(contact_method)\n            except json.JSONDecodeError:\n                contact_method = {}\n\n    except Exception as e:\n        print(f\"Error retrieving customer data: {str(e)}\")\n\n        agent = event['agent']\n        function = event['function']\n        actionGroup = event['actionGroup']\n\n        response_body = {\n            'TEXT': {\n                'body': json.dumps({\n                    \"message\": \"Customer ID not found in DynamoDB\",\n                })\n            }\n        }\n        function_response = {\n            'actionGroup': event['actionGroup'],\n            'function': event['function'],\n            'functionResponse': {\n                'responseBody': response_body\n            }\n        }\n\n        session_attributes = event['sessionAttributes']\n        prompt_session_attributes = event['promptSessionAttributes']\n\n        action_response = {\n            'messageVersion': '1.0', \n            'response': function_response,\n            'sessionAttributes': session_attributes,\n            'promptSessionAttributes': prompt_session_attributes\n        }\n        \n        return action_response\n\n    request_id = str(uuid.uuid4())\n\n    response_body = {\n        'TEXT': {\n            'body': json.dumps({\n                \"dealerId\": dealer_name,\n                \"appointmentDate\": appointment_date,\n                \"appointmentTime\": appointment_time,\n                \"customer\": {\n                    \"name\": {\n                        \"firstName\": first_name,\n                        \"lastName\": last_name\n                    },\n                    \"contactMethod\": [\n                        {\n                            \"type\": contact_method.get(\"type\", \"phone\"),\n                            \"value\": contact_method.get(\"value\", \"\"),\n                            \"use\": contact_method.get(\"use\", \"home\"),\n                            \"rank\": contact_method.get(\"rank\", 1),\n                            \"preferredContactTime\": preferred_contact_time,\n                            \"consent\": consent\n                        }\n                    ]\n                },\n                \"requestId\": request_id,\n                \"vehicle\": {\n                    \"vin\": vin\n                },\n                \"serviceOperations\": [\n                    {\n                        \"customerComments\": \"Some comments about this specific service operation\"\n                    }\n                ]\n            })\n        }\n    }\n\n    print(f\"Response Body: {response_body}\")\n\n    function_response = {\n        'actionGroup': event['actionGroup'],\n        'function': event['function'],\n        'functionResponse': {\n            'responseBody': response_body\n        }\n    }\n\n    session_attributes = event['sessionAttributes']\n    prompt_session_attributes = event['promptSessionAttributes']\n\n    action_response = {\n        'messageVersion': '1.0', \n        'response': function_response,\n        'sessionAttributes': session_attributes,\n        'promptSessionAttributes': prompt_session_attributes\n    }\n    \n    return action_response\n"},"functionName":"BookAppointmentStar","handler":"index.lambda_handler","memorySize":256,"role":{"Fn::GetAtt":["VistaLambdaExecutionRole67057059","Arn"]},"runtime":"python3.9","timeout":30}}},"BedrockInvokePermissionBusinessLogicBookappointmentstarFunction":{"id":"BedrockInvokePermissionBusinessLogicBookappointmentstarFunction","path":"VistaServiceStack/BusinessLogicBookappointmentstarFunction/BedrockInvokePermissionBusinessLogicBookappointmentstarFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["BusinessLogicBookappointmentstarFunctionA09CBBE9","Arn"]},"principal":"bedrock.amazonaws.com"}}}}},"BusinessLogicGet_Parts_For_DtcFunction":{"id":"BusinessLogicGet_Parts_For_DtcFunction","path":"VistaServiceStack/BusinessLogicGet_Parts_For_DtcFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/BusinessLogicGet_Parts_For_DtcFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["arm64"],"code":{"zipFile":"import boto3\nimport json\n\ndynamodb = boto3.resource(\"dynamodb\")\ntable = dynamodb.Table(\"dtc-parts-lookup\")\n\ndef lambda_handler(event, context):\n\n    if \"parameters\" in event:\n        dtc_code = \"\"\n        for param in event[\"parameters\"]:\n            if param.get(\"name\") == \"dtc_code\":\n                dtc_code = param.get(\"value\", \"\")\n    else:\n        dtc_code = event.get(\"dtc_code\")\n\n    agent = event['agent']\n    function = event['function']\n    actionGroup = event['actionGroup']\n    \n    if not dtc_code:\n        response_body = {\n            'TEXT': {\n                'body': 'Missing DTC Code in Input'\n            }\n        }\n        \n        function_response = {\n            'actionGroup': event['actionGroup'],\n            'function': event['function'],\n            'functionResponse': {\n                'responseBody': response_body\n            }\n        }\n\n        session_attributes = event['sessionAttributes']\n        prompt_session_attributes = event['promptSessionAttributes']\n\n        action_response = {\n            'messageVersion': '1.0', \n            'response': function_response,\n            'sessionAttributes': session_attributes,\n            'promptSessionAttributes': prompt_session_attributes\n            }\n                \n        return action_response\n    \n    # Convert DTC code to uppercase for consistent matching\n    dtc_code = dtc_code.upper()\n    \n    try:\n        response = table.query(\n            KeyConditionExpression=boto3.dynamodb.conditions.Key(\"dtc_code\").eq(dtc_code)\n        )\n        \n        items = response.get(\"Items\", [])\n\n        if not items:\n            response_body = {\n                'TEXT': {\n                    'body': f\"DTC code '{dtc_code}' was not found in DynamoDB\"\n                }\n            }\n        else:\n            response_body = {\n                'TEXT': {\n                    'body': json.dumps(items)\n                }\n            }\n    except Exception as e:\n        # Handle any errors that occur during the DynamoDB query\n        error_message = f\"Error querying DynamoDB: {str(e)}\"\n        print(error_message)  # Log the error\n        \n        response_body = {\n            'TEXT': {\n                'body': error_message\n            }\n        }\n    \n    function_response = {\n        'actionGroup': event['actionGroup'],\n        'function': event['function'],\n        'functionResponse': {\n            'responseBody': response_body\n        }\n    }\n\n    session_attributes = event['sessionAttributes']\n    prompt_session_attributes = event['promptSessionAttributes']\n\n    action_response = {\n        'messageVersion': '1.0', \n        'response': function_response,\n        'sessionAttributes': session_attributes,\n        'promptSessionAttributes': prompt_session_attributes\n        }\n        \n    return action_response\n"},"environment":{"variables":{"TABLE_NAME":{"Ref":"DtcPartsLookupTable0FA63289"}}},"functionName":"get-parts-for-dtc","handler":"index.lambda_handler","memorySize":512,"role":{"Fn::GetAtt":["VistaLambdaExecutionRole67057059","Arn"]},"runtime":"python3.13","timeout":30}}},"BedrockInvokePermissionBusinessLogicGet_Parts_For_DtcFunction":{"id":"BedrockInvokePermissionBusinessLogicGet_Parts_For_DtcFunction","path":"VistaServiceStack/BusinessLogicGet_Parts_For_DtcFunction/BedrockInvokePermissionBusinessLogicGet_Parts_For_DtcFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["BusinessLogicGetPartsForDtcFunction2184BE34","Arn"]},"principal":"bedrock.amazonaws.com"}}}}},"BusinessLogicPlace_Parts_OrderFunction":{"id":"BusinessLogicPlace_Parts_OrderFunction","path":"VistaServiceStack/BusinessLogicPlace_Parts_OrderFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/BusinessLogicPlace_Parts_OrderFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["arm64"],"code":{"zipFile":"import boto3\nimport json\nfrom botocore.exceptions import ClientError\n\ndynamodb = boto3.resource(\"dynamodb\")\ndealer_order_table = dynamodb.Table(\"dealer-parts-order\")\n\ndef place_order(dealer_code, part_code, quantity, event):\n    \n    # Define the key to check for the item\n    key = {\n        \"dealer_code\": dealer_code,\n        \"part_code\": part_code\n    }\n\n    try:\n        quantity_value = int(quantity) if isinstance(quantity, (int, float)) else 1\n        response = dealer_order_table.update_item(\n            Key=key,\n            UpdateExpression=\"ADD quantity :quantity\",  \n            ExpressionAttributeValues={\n                \":quantity\": quantity_value \n            },\n            ReturnValues=\"UPDATED_NEW\"  \n        )\n        print (quantity_value, part_code, dealer_code)\n        # If the update is successful, return the success message\n        response_body = {\n            'TEXT': {\n                'body': json.dumps({\"message\": \"parts order successfully placed\"})\n            }\n        }\n    \n    except ClientError as e:\n        # If an error occurs, handle it here (logging or rethrowing)\n        response_body = {\n            'TEXT': {\n                'body': json.dumps({\"message\": f\"Error: {str(e)}\"})\n            }\n        }\n\n    function_response = {\n        'actionGroup': event['actionGroup'],\n        'function': event['function'],\n        'functionResponse': {\n            'responseBody': response_body\n        }\n    }\n\n    session_attributes = event['sessionAttributes']\n    prompt_session_attributes = event['promptSessionAttributes']\n\n    action_response = {\n        'messageVersion': '1.0', \n        'response': function_response,\n        'sessionAttributes': session_attributes,\n        'promptSessionAttributes': prompt_session_attributes\n    }\n    print (action_response)\n    return action_response\n\ndef lambda_handler(event, context):\n\n    if \"parameters\" in event:\n        # Loop through the parameters list to find the dealer, part code and quantity\n        dealer_code = \"\"\n        part_code = \"\"\n        quantity = \"\"\n        for param in event[\"parameters\"]:\n            if param.get(\"name\") == \"dealer_code\":\n                dealer_code = param.get(\"value\", \"\")\n            elif param.get(\"name\") == \"part_code\":\n                part_code = param.get(\"value\", \"\")\n            elif param.get(\"name\") == \"quantity\":\n                quantity = param.get(\"value\", \"\")\n    else:\n        dealer_code = event.get(\"dealer_code\")\n        part_code = event.get(\"part_code\")\n        quantity = event.get(\"quantity\")\n\n    agent = event['agent']\n    function = event['function']\n    actionGroup = event['actionGroup']\n\n    if not dealer_code or not part_code or not quantity:\n        response_body = {\n            'TEXT': {\n                'body': json.dumps({\"message\": \"Missing dealer_code, part_code, or quantity in request\"})\n            }\n        }\n\n        function_response = {\n            'actionGroup': event['actionGroup'],\n            'function': event['function'],\n            'functionResponse': {\n            'responseBody': response_body\n            }\n        }   \n\n        session_attributes = event['sessionAttributes']\n        prompt_session_attributes = event['promptSessionAttributes']\n\n        action_response = {\n            'messageVersion': '1.0', \n            'response': function_response,\n            'sessionAttributes': session_attributes,\n            'promptSessionAttributes': prompt_session_attributes\n        }\n        print (action_response)\n        return action_response\n        \n    return place_order(dealer_code, part_code, quantity, event)\n"},"environment":{"variables":{"TABLE_NAME":{"Ref":"DealerPartsOrderTable027BF592"}}},"functionName":"place-parts-order","handler":"index.lambda_handler","memorySize":512,"role":{"Fn::GetAtt":["VistaLambdaExecutionRole67057059","Arn"]},"runtime":"python3.13","timeout":30}}},"BedrockInvokePermissionBusinessLogicPlace_Parts_OrderFunction":{"id":"BedrockInvokePermissionBusinessLogicPlace_Parts_OrderFunction","path":"VistaServiceStack/BusinessLogicPlace_Parts_OrderFunction/BedrockInvokePermissionBusinessLogicPlace_Parts_OrderFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["BusinessLogicPlacePartsOrderFunction75A648BD","Arn"]},"principal":"bedrock.amazonaws.com"}}}}},"BusinessLogicGet_Dealer_StockFunction":{"id":"BusinessLogicGet_Dealer_StockFunction","path":"VistaServiceStack/BusinessLogicGet_Dealer_StockFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/BusinessLogicGet_Dealer_StockFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["arm64"],"code":{"zipFile":"import boto3\nimport json\nfrom decimal import Decimal\n\ndynamodb = boto3.resource(\"dynamodb\")\ndealer_stock_table = dynamodb.Table(\"dealer-parts-stock\")\n\nclass DecimalEncoder(json.JSONEncoder):\n    def default(self, o):\n        if isinstance(o, Decimal):\n            return float(o)\n        return super(DecimalEncoder, self).default(o)\n\ndef get_dealer_stock(dealer_code, part_code):\n    response = dealer_stock_table.get_item(\n        Key={\"dealer_code\": dealer_code, \"part_code\": part_code}\n    )\n    item = response.get(\"Item\", {})\n    if not item:\n        return {\"dealer_code\": dealer_code, \"part_code\": part_code, \"stock\": 0}\n\n    return item\n\ndef lambda_handler(event, context):\n\n    dealer_code = \"\"\n    part_code = \"\"\n\n    if \"parameters\" in event:\n        for param in event[\"parameters\"]:\n            if param.get(\"name\") == \"dealer_code\" or \\\n               param.get(\"name\") == \"dealer_name\":\n                dealer_code = param.get(\"value\", \"\")\n            elif param.get(\"name\") == \"part_code\":\n                part_code = param.get(\"value\", \"\")\n    else:\n        dealer_code = event[\"dealer_code\"]\n        part_code = event[\"part_code\"]\n    \n    agent = event['agent']\n    function = event['function']\n    actionGroup = event['actionGroup']\n\n    if not dealer_code or not part_code:\n        print (\"Missing dealer_code or part_code in request\")\n        response_body = {\n        'TEXT': {\n            'body': 'Missing dealer_code or part_code in request'\n            }\n        }\n    else:\n        # Convert part_code to uppercase for consistent matching\n        part_code = part_code.upper()\n        \n        # Format dealer_code with proper capitalization (capitalize first letter of each word)\n        dealer_code = \" \".join(word.capitalize() for word in dealer_code.split())\n        \n        stock_data = get_dealer_stock(dealer_code, part_code)\n        \n        # Handle different capitalization of 'stock' field and set default to 0 if not found\n        if 'stock' in stock_data:\n            stock_data['stock'] = int(stock_data['stock'])\n        elif 'Stock' in stock_data:\n            stock_data['stock'] = int(stock_data['Stock'])\n            # Remove the capitalized version to standardize the response\n            del stock_data['Stock']\n        else:\n            stock_data['stock'] = 0\n            \n        response_body = {\n        'TEXT': {\n            'body': json.dumps(stock_data, cls=DecimalEncoder)\n            }\n        }\n\n    function_response = {\n        'actionGroup': event['actionGroup'],\n        'function': event['function'],\n        'functionResponse': {\n            'responseBody': response_body\n        }\n    }\n\n    session_attributes = event['sessionAttributes']\n    prompt_session_attributes = event['promptSessionAttributes']\n\n    action_response = {\n        'messageVersion': '1.0', \n        'response': function_response,\n        'sessionAttributes': session_attributes,\n        'promptSessionAttributes': prompt_session_attributes\n        }\n        \n    return action_response\n"},"environment":{"variables":{"TABLE_NAME":{"Ref":"DealerDataTableE4DC8147"}}},"functionName":"get-dealer-stock","handler":"index.lambda_handler","memorySize":512,"role":{"Fn::GetAtt":["VistaLambdaExecutionRole67057059","Arn"]},"runtime":"python3.13","timeout":30}}},"BedrockInvokePermissionBusinessLogicGet_Dealer_StockFunction":{"id":"BedrockInvokePermissionBusinessLogicGet_Dealer_StockFunction","path":"VistaServiceStack/BusinessLogicGet_Dealer_StockFunction/BedrockInvokePermissionBusinessLogicGet_Dealer_StockFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["BusinessLogicGetDealerStockFunctionF226E87C","Arn"]},"principal":"bedrock.amazonaws.com"}}}}},"BusinessLogicGetwarrantydataFunction":{"id":"BusinessLogicGetwarrantydataFunction","path":"VistaServiceStack/BusinessLogicGetwarrantydataFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/BusinessLogicGetwarrantydataFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["x86_64"],"code":{"zipFile":"import json\nimport boto3\n\ndynamodb = boto3.resource(\"dynamodb\")\ntable = dynamodb.Table(\"warranty-info\")\n\ndef lambda_handler(event, context):\n    # Extract VIN from parameters or directly from event\n    VIN = \"\"\n    if \"parameters\" in event:\n        for param in event[\"parameters\"]:\n            if param.get(\"name\") == \"VIN\":\n                VIN = param.get(\"value\", \"\")\n                break\n    else:\n        VIN = event.get('VIN', '')\n\n    # Extract metadata\n    action_group = event.get('actionGroup', '')\n    function = event.get('function', '')\n    session_attributes = event.get('sessionAttributes', {})\n    prompt_session_attributes = event.get('promptSessionAttributes', {})\n\n    try:\n        # VIN is missing\n        if not VIN:\n            response_body = {\n                'TEXT': {\n                    'body': json.dumps(\"VIN is required in input\")\n                }\n            }\n        else:\n            # Query DynamoDB\n            response = table.get_item(Key={\"VIN\": VIN})\n\n            # VIN not found\n            if \"Item\" not in response:\n                response_body = {\n                    'TEXT': {\n                        'body': json.dumps(\"VIN not found\")\n                    }\n                }\n            else:\n                # VIN found\n                response_body = {\n                    'TEXT': {\n                        'body': json.dumps(response[\"Item\"])\n                    }\n                }\n\n        # Construct standardized response\n        function_response = {\n            'actionGroup': action_group,\n            'function': function,\n            'functionResponse': {\n                'responseBody': response_body\n            }\n        }\n\n        action_response = {\n            'messageVersion': '1.0',\n            'response': function_response,\n            'sessionAttributes': session_attributes,\n            'promptSessionAttributes': prompt_session_attributes\n        }\n\n        print(action_response)\n        return action_response\n\n    except Exception as e:\n        # Graceful error response\n        error_response = {\n            'TEXT': {\n                'body': json.dumps(\"An internal error occurred.\")\n            }\n        }\n\n        function_response = {\n            'actionGroup': action_group,\n            'function': function,\n            'functionResponse': {\n                'responseBody': error_response\n            }\n        }\n\n        action_response = {\n            'messageVersion': '1.0',\n            'response': function_response,\n            'sessionAttributes': session_attributes,\n            'promptSessionAttributes': prompt_session_attributes\n        }\n\n        print(f\"Error: {str(e)}\")\n        return action_response\n"},"environment":{"variables":{"TABLE_NAME":{"Ref":"WarrantyInfoTable6E3B5583"}}},"functionName":"GetWarrantyData","handler":"index.lambda_handler","memorySize":128,"role":{"Fn::GetAtt":["VistaLambdaExecutionRole67057059","Arn"]},"runtime":"python3.13","timeout":30}}},"BedrockInvokePermissionBusinessLogicGetwarrantydataFunction":{"id":"BedrockInvokePermissionBusinessLogicGetwarrantydataFunction","path":"VistaServiceStack/BusinessLogicGetwarrantydataFunction/BedrockInvokePermissionBusinessLogicGetwarrantydataFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["BusinessLogicGetwarrantydataFunction33B1D1A8","Arn"]},"principal":"bedrock.amazonaws.com"}}}}},"SampledatafunctionRole":{"id":"SampledatafunctionRole","path":"VistaServiceStack/SampledatafunctionRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.206.0","metadata":[]},"children":{"ImportSampledatafunctionRole":{"id":"ImportSampledatafunctionRole","path":"VistaServiceStack/SampledatafunctionRole/ImportSampledatafunctionRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.206.0","metadata":[]}},"Resource":{"id":"Resource","path":"VistaServiceStack/SampledatafunctionRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"VistaServiceStack/SampledatafunctionRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/SampledatafunctionRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:BatchWriteItem","dynamodb:PutItem"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["CustomerUserProfileTableE31D7E5E","Arn"]},{"Fn::GetAtt":["DealerAppointmentDataTableE5466EB8","Arn"]},{"Fn::GetAtt":["DealerDataTableE4DC8147","Arn"]},{"Fn::GetAtt":["DealerPartsOrderTable027BF592","Arn"]},{"Fn::GetAtt":["DealerPartsStockTable57B8B9FF","Arn"]},{"Fn::GetAtt":["DtcPartsLookupTable0FA63289","Arn"]},{"Fn::GetAtt":["WarrantyInfoTable6E3B5583","Arn"]}]}],"Version":"2012-10-17"},"policyName":"SampledatafunctionRoleDefaultPolicy15FC6A32","roles":[{"Ref":"SampledatafunctionRoleCAA4395D"}]}}}}}}},"DataLoaderSampledatafunctionFunction":{"id":"DataLoaderSampledatafunctionFunction","path":"VistaServiceStack/DataLoaderSampledatafunctionFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/DataLoaderSampledatafunctionFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"import boto3\nimport json\nimport urllib.request\nfrom decimal import Decimal\n\ndef handler(event, context):\n    print(f\"Received event: {json.dumps(event)}\")\n    \n    # Extract request details\n    response_url = event.get('ResponseURL')\n    stack_id = event.get('StackId')\n    request_id = event.get('RequestId')\n    logical_resource_id = event.get('LogicalResourceId')\n    physical_resource_id = event.get('PhysicalResourceId', 'SampleDataPopulation')\n    \n    # Prepare the response payload\n    response_body = {\n        'Status': 'SUCCESS',\n        'PhysicalResourceId': physical_resource_id,\n        'StackId': stack_id,\n        'RequestId': request_id,\n        'LogicalResourceId': logical_resource_id\n    }\n    \n    # For Delete requests, just send success response\n    if event.get('RequestType') == 'Delete':\n        print(\"Delete request - sending success response\")\n        send_response(response_url, response_body)\n        return\n    \n    try:\n        dynamodb = boto3.resource('dynamodb')\n        table = dynamodb.Table('dealer-data')\n        \n        # Sample data with additional fields\n        sample_data = [\n            {\n                'dealer_code': 'D037',\n                'city_name': 'Berkeley',\n                'dealer_name': 'Legend Motors',\n                'latitude': Decimal('37.8775'),\n                'longitude': Decimal('-122.279'),\n                'website': 'https://www.legendmotors.com',\n                'street': '2107 Shattuck Ave',\n                'city': 'Berkeley',\n                'state': 'CA',\n                'country': 'USA',\n                'zip': '94704',\n                'phone': '(510) 555-1234',\n                'email': 'sales@legendmotors.com'\n            },\n            {\n                'dealer_code': 'D042',\n                'city_name': 'Palo Alto',\n                'dealer_name': 'Quest Autos',\n                'latitude': Decimal('37.442899999999995'),\n                'longitude': Decimal('-122.144'),\n                'website': 'https://www.questautos.com',\n                'street': '1730 Embarcadero Rd',\n                'city': 'Palo Alto',\n                'state': 'CA',\n                'country': 'USA',\n                'zip': '94303',\n                'phone': '(650) 555-8765',\n                'email': 'info@questautos.com'\n            },\n            {\n                'dealer_code': 'D072',\n                'city_name': 'Mountain View',\n                'dealer_name': 'Unity Cars',\n                'latitude': Decimal('37.3871'),\n                'longitude': Decimal('-122.0849'),\n                'website': 'https://www.unitycars.com',\n                'street': '2500 El Camino Real',\n                'city': 'Mountain View',\n                'state': 'CA',\n                'country': 'USA',\n                'zip': '94040',\n                'phone': '(650) 555-9876',\n                'email': 'sales@unitycars.com'\n            },\n            {\n                'dealer_code': 'D011',\n                'city_name': 'Oakland',\n                'dealer_name': 'Keen Cars',\n                'latitude': Decimal('37.8044'),\n                'longitude': Decimal('-122.2711'),\n                'website': 'https://www.keencars.com',\n                'street': '3400 Broadway',\n                'city': 'Oakland',\n                'state': 'CA',\n                'country': 'USA',\n                'zip': '94611',\n                'phone': '(510) 555-4321',\n                'email': 'contact@keencars.com'\n            },\n            {\n                'dealer_code': 'D028',\n                'city_name': 'San Jose',\n                'dealer_name': 'Crown Cars',\n                'latitude': Decimal('37.3452'),\n                'longitude': Decimal('-121.89330000000001'),\n                'website': 'https://www.crowncars.com',\n                'street': '1302 N First St',\n                'city': 'San Jose',\n                'state': 'CA',\n                'country': 'USA',\n                'zip': '95112',\n                'phone': '(408) 555-7890',\n                'email': 'info@crowncars.com'\n            },\n            {\n                'dealer_code': 'D055',\n                'city_name': 'Fremont',\n                'dealer_name': 'Apex Autos',\n                'latitude': Decimal('37.7749'),\n                'longitude': Decimal('-122.4194'),\n                'website': 'https://www.apexautos.com',\n                'street': '43191 Mission Blvd',\n                'city': 'Fremont',\n                'state': 'CA',\n                'country': 'USA',\n                'zip': '94539',\n                'phone': '(510) 555-6543',\n                'email': 'sales@apexautos.com'\n            },\n            {\n                'dealer_code': 'D099',\n                'city_name': 'San Francisco',\n                'dealer_name': 'Bay Area Autos',\n                'latitude': Decimal('37.7833'),\n                'longitude': Decimal('-122.4167'),\n                'website': 'https://www.bayareaautos.com',\n                'street': '1000 Van Ness Ave',\n                'city': 'San Francisco',\n                'state': 'CA',\n                'country': 'USA',\n                'zip': '94109',\n                'phone': '(415) 555-2345',\n                'email': 'info@bayareaautos.com'\n            }\n        ]\n        \n        # Put the items\n        for item in sample_data:\n            table.put_item(Item=item)\n            print(f\"Added item: {item['dealer_code']} - {item['city_name']}\")\n        \n        print(f\"Successfully added {len(sample_data)} sample records\")\n        \n        # Add data to response\n        response_body['Data'] = {'Message': f\"Added {len(sample_data)} sample records\"}\n        \n        # Send success response\n        send_response(response_url, response_body)\n    except Exception as e:\n        error_message = str(e)\n        print(f\"Error adding sample data: {error_message}\")\n        \n        # Send failure response\n        response_body['Status'] = 'FAILED'\n        response_body['Reason'] = error_message\n        send_response(response_url, response_body)\n\ndef send_response(response_url, response_body):\n    \"\"\"Send a response to CloudFormation to handle the custom resource.\"\"\"\n    json_response_body = json.dumps(response_body)\n    \n    print(f\"Sending response to: {response_url}\")\n    print(f\"Response body: {json_response_body}\")\n    \n    headers = {\n        'content-type': '',\n        'content-length': str(len(json_response_body))\n    }\n    \n    try:\n        req = urllib.request.Request(response_url, \n                                    data=json_response_body.encode('utf-8'),\n                                    headers=headers,\n                                    method='PUT')\n        \n        response = urllib.request.urlopen(req)\n        print(f\"Status code: {response.getcode()}\")\n        print(f\"Status message: {response.msg}\")\n        return True\n    except Exception as e:\n        print(f\"Failed to send response: {str(e)}\")\n        return False\n"},"functionName":"data-loader-SampleDataFunction","handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["SampledatafunctionRoleCAA4395D","Arn"]},"runtime":"python3.9","timeout":30}}}}},"InsertcustomerprofilesRole":{"id":"InsertcustomerprofilesRole","path":"VistaServiceStack/InsertcustomerprofilesRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.206.0","metadata":[]},"children":{"ImportInsertcustomerprofilesRole":{"id":"ImportInsertcustomerprofilesRole","path":"VistaServiceStack/InsertcustomerprofilesRole/ImportInsertcustomerprofilesRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.206.0","metadata":[]}},"Resource":{"id":"Resource","path":"VistaServiceStack/InsertcustomerprofilesRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"VistaServiceStack/InsertcustomerprofilesRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/InsertcustomerprofilesRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:BatchWriteItem","dynamodb:PutItem"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["CustomerUserProfileTableE31D7E5E","Arn"]},{"Fn::GetAtt":["DealerAppointmentDataTableE5466EB8","Arn"]},{"Fn::GetAtt":["DealerDataTableE4DC8147","Arn"]},{"Fn::GetAtt":["DealerPartsOrderTable027BF592","Arn"]},{"Fn::GetAtt":["DealerPartsStockTable57B8B9FF","Arn"]},{"Fn::GetAtt":["DtcPartsLookupTable0FA63289","Arn"]},{"Fn::GetAtt":["WarrantyInfoTable6E3B5583","Arn"]}]}],"Version":"2012-10-17"},"policyName":"InsertcustomerprofilesRoleDefaultPolicy9B48D373","roles":[{"Ref":"InsertcustomerprofilesRoleDD19F80A"}]}}}}}}},"DataLoaderInsertcustomerprofilesFunction":{"id":"DataLoaderInsertcustomerprofilesFunction","path":"VistaServiceStack/DataLoaderInsertcustomerprofilesFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/DataLoaderInsertcustomerprofilesFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"import boto3\nimport json\nimport urllib.request\nfrom decimal import Decimal\n\ndef handler(event, context):\n    print(f\"Received event: {json.dumps(event)}\")\n    \n    # Extract request details\n    response_url = event.get('ResponseURL')\n    stack_id = event.get('StackId')\n    request_id = event.get('RequestId')\n    logical_resource_id = event.get('LogicalResourceId')\n    physical_resource_id = event.get('PhysicalResourceId', 'CustomerProfilesDataPopulation')\n    \n    # Prepare the response payload\n    response_body = {\n        'Status': 'SUCCESS',\n        'PhysicalResourceId': physical_resource_id,\n        'StackId': stack_id,\n        'RequestId': request_id,\n        'LogicalResourceId': logical_resource_id\n    }\n    \n    # For Delete requests, just send success response\n    if event.get('RequestType') == 'Delete':\n        print(\"Delete request - sending success response\")\n        send_response(response_url, response_body)\n        return\n    \n    try:\n        dynamodb = boto3.resource('dynamodb')\n        table = dynamodb.Table('customer-user-profile')\n        \n        # Sample customer user profile data\n        sample_customers = [\n            {\n                'customer_id': 'CUST001',\n                'first_name': 'Jane',\n                'last_name': 'Smith',\n                'email': 'jane.smith@example.com',\n                'phone': '555-123-4567',\n                'address': '123 Main St, Anytown, USA',\n                'registration_date': '2025-01-15',\n                'preferred_contact_time': 'Mon-Fri between 9 AM and 5 PM',\n                'VIN': '1GCNCPEX5DZ000001',\n                'contact_method': 'email',\n                'consent': 'true',\n                'status': 'active'\n            },\n            {\n                'customer_id': 'CUST002',\n                'first_name': 'Michael',\n                'last_name': 'Johnson',\n                'email': 'michael.johnson@example.com',\n                'phone': '555-234-5678',\n                'address': '456 Oak Ave, Somewhere, USA',\n                'registration_date': '2025-02-20',\n                'preferred_contact_time': 'Weekends only',\n                'VIN': '1GCNCPEX5DZ000002',\n                'contact_method': 'sms',\n                'consent': 'true',\n                'status': 'active'\n            },\n            {\n                'customer_id': 'CUST003',\n                'first_name': 'Emily',\n                'last_name': 'Williams',\n                'email': 'emily.williams@example.com',\n                'phone': '555-345-6789',\n                'address': '789 Pine Rd, Elsewhere, USA',\n                'registration_date': '2025-03-10',\n                'preferred_contact_time': 'Evenings after 6 PM',\n                'VIN': '1GCNCPEX5DZ000003',\n                'contact_method': 'phone',\n                'consent': 'false',\n                'status': 'inactive'\n            },\n            {\n                'customer_id': 'CUST004',\n                'first_name': 'David',\n                'last_name': 'Brown',\n                'email': 'david.brown@example.com',\n                'phone': '555-456-7890',\n                'address': '101 Cedar Ln, Nowhere, USA',\n                'registration_date': '2025-04-05',\n                'preferred_contact_time': 'Anytime',\n                'VIN': '1GCNCPEX5DZ000004',\n                'contact_method': 'email',\n                'consent': 'true',\n                'status': 'active'\n            },\n            {\n                'customer_id': 'CUST005',\n                'first_name': 'Sarah',\n                'last_name': 'Miller',\n                'email': 'sarah.miller@example.com',\n                'phone': '555-567-8901',\n                'address': '202 Maple Dr, Anywhere, USA',\n                'registration_date': '2025-05-01',\n                'preferred_contact_time': 'Tue-Thu between 1 PM and 4 PM',\n                'VIN': '1GCNCPEX5DZ000005',\n                'contact_method': 'sms',\n                'consent': 'true',\n                'status': 'active'\n            }\n        ]\n        \n        # Put the items\n        for item in sample_customers:\n            table.put_item(Item=item)\n            print(f\"Added item: {item['customer_id']} - {item['first_name']} {item['last_name']}\")\n        \n        print(f\"Successfully added {len(sample_customers)} sample records\")\n        \n        # Add data to response\n        response_body['Data'] = {'Message': f\"Added {len(sample_customers)} sample records\"}\n        \n        # Send success response\n        send_response(response_url, response_body)\n    except Exception as e:\n        error_message = str(e)\n        print(f\"Error adding sample data: {error_message}\")\n        \n        # Send failure response\n        response_body['Status'] = 'FAILED'\n        response_body['Reason'] = error_message\n        send_response(response_url, response_body)\n\ndef send_response(response_url, response_body):\n    \"\"\"Send a response to CloudFormation to handle the custom resource.\"\"\"\n    json_response_body = json.dumps(response_body)\n    \n    print(f\"Sending response to: {response_url}\")\n    print(f\"Response body: {json_response_body}\")\n    \n    headers = {\n        'content-type': '',\n        'content-length': str(len(json_response_body))\n    }\n    \n    try:\n        req = urllib.request.Request(response_url, \n                                    data=json_response_body.encode('utf-8'),\n                                    headers=headers,\n                                    method='PUT')\n        \n        response = urllib.request.urlopen(req)\n        print(f\"Status code: {response.getcode()}\")\n        print(f\"Status message: {response.msg}\")\n        return True\n    except Exception as e:\n        print(f\"Failed to send response: {str(e)}\")\n        print(f\"Error details: {str(e)}\")\n        return False\n"},"functionName":"data-loader-InsertCustomerProfiles","handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["InsertcustomerprofilesRoleDD19F80A","Arn"]},"runtime":"python3.9","timeout":60}}}}},"Dtc_Parts_Data_LoaderRole":{"id":"Dtc_Parts_Data_LoaderRole","path":"VistaServiceStack/Dtc_Parts_Data_LoaderRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.206.0","metadata":[]},"children":{"ImportDtc_Parts_Data_LoaderRole":{"id":"ImportDtc_Parts_Data_LoaderRole","path":"VistaServiceStack/Dtc_Parts_Data_LoaderRole/ImportDtc_Parts_Data_LoaderRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.206.0","metadata":[]}},"Resource":{"id":"Resource","path":"VistaServiceStack/Dtc_Parts_Data_LoaderRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"VistaServiceStack/Dtc_Parts_Data_LoaderRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/Dtc_Parts_Data_LoaderRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:BatchWriteItem","dynamodb:PutItem"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["CustomerUserProfileTableE31D7E5E","Arn"]},{"Fn::GetAtt":["DealerAppointmentDataTableE5466EB8","Arn"]},{"Fn::GetAtt":["DealerDataTableE4DC8147","Arn"]},{"Fn::GetAtt":["DealerPartsOrderTable027BF592","Arn"]},{"Fn::GetAtt":["DealerPartsStockTable57B8B9FF","Arn"]},{"Fn::GetAtt":["DtcPartsLookupTable0FA63289","Arn"]},{"Fn::GetAtt":["WarrantyInfoTable6E3B5583","Arn"]}]}],"Version":"2012-10-17"},"policyName":"DtcPartsDataLoaderRoleDefaultPolicy2F0370E5","roles":[{"Ref":"DtcPartsDataLoaderRole8F48A7BD"}]}}}}}}},"DataLoaderDtc_Parts_Data_LoaderFunction":{"id":"DataLoaderDtc_Parts_Data_LoaderFunction","path":"VistaServiceStack/DataLoaderDtc_Parts_Data_LoaderFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/DataLoaderDtc_Parts_Data_LoaderFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"import boto3\nimport json\nimport urllib.request\nimport logging\n\nlogger = logging.getLogger()\nlogger.setLevel(logging.INFO)\n\ndef handler(event, context):\n    logger.info('Received event: %s', json.dumps(event))\n    \n    # Extract request details\n    response_url = event.get('ResponseURL')\n    stack_id = event.get('StackId')\n    request_id = event.get('RequestId')\n    logical_resource_id = event.get('LogicalResourceId')\n    physical_resource_id = event.get('PhysicalResourceId', 'DtcPartsDataLoader')\n    \n    # Prepare the response payload\n    response_body = {\n        'Status': 'SUCCESS',\n        'PhysicalResourceId': physical_resource_id,\n        'StackId': stack_id,\n        'RequestId': request_id,\n        'LogicalResourceId': logical_resource_id\n    }\n    \n    # For Delete requests, just send success response\n    if event.get('RequestType') == 'Delete':\n        logger.info(\"Delete request - sending success response\")\n        send_response(response_url, response_body)\n        return\n    \n    try:\n        # Initialize DynamoDB client\n        dynamodb = boto3.resource('dynamodb')\n        table = dynamodb.Table('dtc-parts-lookup')\n        \n        # Define the items to be loaded\n        items = [\n            {\n                \"dtc_code\": \"P0442\",\n                \"part_code\": \"EVAP-005\",\n                \"part_description\": \"EVAP Canister Purge Valve\"\n            },\n            {\n                \"dtc_code\": \"P0171\",\n                \"part_code\": \"MAF-002\",\n                \"part_description\": \"Mass Air Flow Sensor\"\n            },\n            {\n                \"dtc_code\": \"P0507\",\n                \"part_code\": \"IAC-004\",\n                \"part_description\": \"Idle Air Control Valve\"\n            },\n            {\n                \"dtc_code\": \"P0113\",\n                \"part_code\": \"IAT-009\",\n                \"part_description\": \"Intake Air Temperature Sensor\"\n            },\n            {\n                \"dtc_code\": \"P0300\",\n                \"part_code\": \"IGN-001\",\n                \"part_description\": \"Ignition Coil\"\n            },\n            {\n                \"dtc_code\": \"P0300\",\n                \"part_code\": \"SPK-011\",\n                \"part_description\": \"Spark Plug\"\n            },\n            {\n                \"dtc_code\": \"P0032\",\n                \"part_code\": \"O2-007\",\n                \"part_description\": \"Oxygen Sensor\"\n            },\n            {\n                \"dtc_code\": \"P0455\",\n                \"part_code\": \"FUEL-006\",\n                \"part_description\": \"Fuel Tank Cap\"\n            },\n            {\n                \"dtc_code\": \"P0325\",\n                \"part_code\": \"KNOCK-010\",\n                \"part_description\": \"Knock Sensor\"\n            },\n            {\n                \"dtc_code\": \"P0420\",\n                \"part_code\": \"CAT-003\",\n                \"part_description\": \"Catalytic Converter\"\n            },\n            {\n                \"dtc_code\": \"P0420\",\n                \"part_code\": \"O2-007\",\n                \"part_description\": \"Oxygen Sensor\"\n            },\n            {\n                \"dtc_code\": \"P0135\",\n                \"part_code\": \"O2-007\",\n                \"part_description\": \"Oxygen Sensor (Bank 1, Sensor 1)\"\n            },\n            {\n                \"dtc_code\": \"P0700\",\n                \"part_code\": \"TCM-008\",\n                \"part_description\": \"Transmission Control Module\"\n            }\n        ]\n        \n        # Use batch write to load items efficiently\n        with table.batch_writer() as batch:\n            for item in items:\n                batch.put_item(Item=item)\n        \n        logger.info('Successfully loaded %s items into DynamoDB table', len(items))\n        \n        # Add data to response\n        response_body['Data'] = {'Message': f\"Added {len(items)} sample records\"}\n        \n        # Send success response\n        send_response(response_url, response_body)\n    except Exception as e:\n        error_message = str(e)\n        logger.error('Error loading data: %s', error_message)\n        \n        # Send failure response\n        response_body['Status'] = 'FAILED'\n        response_body['Reason'] = error_message\n        send_response(response_url, response_body)\n\ndef send_response(response_url, response_body):\n    \"\"\"Send a response to CloudFormation to handle the custom resource.\"\"\"\n    json_response_body = json.dumps(response_body)\n    \n    logger.info(f\"Sending response to: {response_url}\")\n    logger.info(f\"Response body: {json_response_body}\")\n    \n    headers = {\n        'content-type': '',\n        'content-length': str(len(json_response_body))\n    }\n    \n    try:\n        req = urllib.request.Request(response_url, \n                                    data=json_response_body.encode('utf-8'),\n                                    headers=headers,\n                                    method='PUT')\n        \n        response = urllib.request.urlopen(req)\n        logger.info(f\"Status code: {response.getcode()}\")\n        logger.info(f\"Status message: {response.msg}\")\n        return True\n    except Exception as e:\n        logger.error(f\"Failed to send response: {str(e)}\")\n        return False\n"},"functionName":"data-loader-dtc-parts-data-loader","handler":"index.handler","memorySize":512,"role":{"Fn::GetAtt":["DtcPartsDataLoaderRole8F48A7BD","Arn"]},"runtime":"python3.13","timeout":30}}}}},"InsertwarrantyinfoRole":{"id":"InsertwarrantyinfoRole","path":"VistaServiceStack/InsertwarrantyinfoRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.206.0","metadata":[]},"children":{"ImportInsertwarrantyinfoRole":{"id":"ImportInsertwarrantyinfoRole","path":"VistaServiceStack/InsertwarrantyinfoRole/ImportInsertwarrantyinfoRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.206.0","metadata":[]}},"Resource":{"id":"Resource","path":"VistaServiceStack/InsertwarrantyinfoRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"VistaServiceStack/InsertwarrantyinfoRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/InsertwarrantyinfoRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:BatchWriteItem","dynamodb:PutItem"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["CustomerUserProfileTableE31D7E5E","Arn"]},{"Fn::GetAtt":["DealerAppointmentDataTableE5466EB8","Arn"]},{"Fn::GetAtt":["DealerDataTableE4DC8147","Arn"]},{"Fn::GetAtt":["DealerPartsOrderTable027BF592","Arn"]},{"Fn::GetAtt":["DealerPartsStockTable57B8B9FF","Arn"]},{"Fn::GetAtt":["DtcPartsLookupTable0FA63289","Arn"]},{"Fn::GetAtt":["WarrantyInfoTable6E3B5583","Arn"]}]}],"Version":"2012-10-17"},"policyName":"InsertwarrantyinfoRoleDefaultPolicyEED3175D","roles":[{"Ref":"InsertwarrantyinfoRole9C0E7519"}]}}}}}}},"DataLoaderInsertwarrantyinfoFunction":{"id":"DataLoaderInsertwarrantyinfoFunction","path":"VistaServiceStack/DataLoaderInsertwarrantyinfoFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/DataLoaderInsertwarrantyinfoFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"import boto3\nimport json\nimport urllib.request\nfrom datetime import datetime, timedelta\n\ndef handler(event, context):\n    print(f\"Received event: {json.dumps(event)}\")\n    \n    # Extract request details\n    response_url = event.get('ResponseURL')\n    stack_id = event.get('StackId')\n    request_id = event.get('RequestId')\n    logical_resource_id = event.get('LogicalResourceId')\n    physical_resource_id = event.get('PhysicalResourceId', 'WarrantyInfoDataPopulation')\n    \n    # Prepare the response payload\n    response_body = {\n        'Status': 'SUCCESS',\n        'PhysicalResourceId': physical_resource_id,\n        'StackId': stack_id,\n        'RequestId': request_id,\n        'LogicalResourceId': logical_resource_id\n    }\n    \n    # For Delete requests, just send success response\n    if event.get('RequestType') == 'Delete':\n        print(\"Delete request - sending success response\")\n        send_response(response_url, response_body)\n        return\n    \n    try:\n        dynamodb = boto3.resource('dynamodb')\n        table = dynamodb.Table('warranty-info')\n        \n        # Current date for warranty calculations\n        current_date = datetime.now()\n        \n        # Sample warranty info data using VINs from the customer profiles\n        sample_warranty_info = [\n            {\n                'VIN': '1GCNCPEX5DZ000001',\n                'make': 'Chevrolet',\n                'model': 'Silverado',\n                'year': '2023',\n                'warranty_active': True,\n                'warranty_end_date': (current_date + timedelta(days=730)).strftime('%Y-%m-%d')  # 2 years from now\n            },\n            {\n                'VIN': '1GCNCPEX5DZ000002',\n                'make': 'Chevrolet',\n                'model': 'Equinox',\n                'year': '2022',\n                'warranty_active': True,\n                'warranty_end_date': (current_date + timedelta(days=365)).strftime('%Y-%m-%d')  # 1 year from now\n            },\n            {\n                'VIN': '1GCNCPEX5DZ000003',\n                'make': 'GMC',\n                'model': 'Sierra',\n                'year': '2021',\n                'warranty_active': False,\n                'warranty_end_date': (current_date - timedelta(days=30)).strftime('%Y-%m-%d')  # Expired 30 days ago\n            },\n            {\n                'VIN': '1GCNCPEX5DZ000004',\n                'make': 'Buick',\n                'model': 'Enclave',\n                'year': '2024',\n                'warranty_active': True,\n                'warranty_end_date': (current_date + timedelta(days=1095)).strftime('%Y-%m-%d')  # 3 years from now\n            },\n            {\n                'VIN': '1GCNCPEX5DZ000005',\n                'make': 'Cadillac',\n                'model': 'Escalade',\n                'year': '2023',\n                'warranty_active': True,\n                'warranty_end_date': (current_date + timedelta(days=1460)).strftime('%Y-%m-%d')  # 4 years from now\n            }\n        ]\n        \n        # Put the items\n        for item in sample_warranty_info:\n            table.put_item(Item=item)\n            print(f\"Added warranty info for VIN: {item['VIN']} - {item['make']} {item['model']}\")\n        \n        print(f\"Successfully added {len(sample_warranty_info)} warranty records\")\n        \n        # Add data to response\n        response_body['Data'] = {'Message': f\"Added {len(sample_warranty_info)} warranty records\"}\n        \n        # Send success response\n        send_response(response_url, response_body)\n    except Exception as e:\n        error_message = str(e)\n        print(f\"Error adding warranty data: {error_message}\")\n        \n        # Send failure response\n        response_body['Status'] = 'FAILED'\n        response_body['Reason'] = error_message\n        send_response(response_url, response_body)\n\ndef send_response(response_url, response_body):\n    \"\"\"Send a response to CloudFormation to handle the custom resource.\"\"\"\n    json_response_body = json.dumps(response_body)\n    \n    print(f\"Sending response to: {response_url}\")\n    print(f\"Response body: {json_response_body}\")\n    \n    headers = {\n        'content-type': '',\n        'content-length': str(len(json_response_body))\n    }\n    \n    try:\n        req = urllib.request.Request(response_url, \n                                    data=json_response_body.encode('utf-8'),\n                                    headers=headers,\n                                    method='PUT')\n        \n        response = urllib.request.urlopen(req)\n        print(f\"Status code: {response.getcode()}\")\n        print(f\"Status message: {response.msg}\")\n        return True\n    except Exception as e:\n        print(f\"Failed to send response: {str(e)}\")\n        print(f\"Error details: {str(e)}\")\n        return False\n"},"functionName":"data-loader-InsertWarrantyInfo","handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["InsertwarrantyinfoRole9C0E7519","Arn"]},"runtime":"python3.13","timeout":60}}}}},"PopulatedataTrigger":{"id":"PopulatedataTrigger","path":"VistaServiceStack/PopulatedataTrigger","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.206.0","metadata":[]},"children":{"Default":{"id":"Default","path":"VistaServiceStack/PopulatedataTrigger/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.206.0"}}}},"PopulatecustomerdataTrigger":{"id":"PopulatecustomerdataTrigger","path":"VistaServiceStack/PopulatecustomerdataTrigger","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.206.0","metadata":[]},"children":{"Default":{"id":"Default","path":"VistaServiceStack/PopulatecustomerdataTrigger/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.206.0"}}}},"DataloadertriggerTrigger":{"id":"DataloadertriggerTrigger","path":"VistaServiceStack/DataloadertriggerTrigger","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.206.0","metadata":[]},"children":{"Default":{"id":"Default","path":"VistaServiceStack/DataloadertriggerTrigger/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.206.0"}}}},"PopulatewarrantydataTrigger":{"id":"PopulatewarrantydataTrigger","path":"VistaServiceStack/PopulatewarrantydataTrigger","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.206.0","metadata":[]},"children":{"Default":{"id":"Default","path":"VistaServiceStack/PopulatewarrantydataTrigger/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.206.0"}}}},"BedrockAgentRole":{"id":"BedrockAgentRole","path":"VistaServiceStack/BedrockAgentRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.206.0","metadata":[]},"children":{"ImportBedrockAgentRole":{"id":"ImportBedrockAgentRole","path":"VistaServiceStack/BedrockAgentRole/ImportBedrockAgentRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.206.0","metadata":[]}},"Resource":{"id":"Resource","path":"VistaServiceStack/BedrockAgentRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"bedrock.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"VistaServiceStack/BedrockAgentRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.206.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VistaServiceStack/BedrockAgentRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["bedrock:AssociateAgentKnowledgeBase","bedrock:CreateAgent","bedrock:CreateAgentActionGroup","bedrock:CreateAgentAlias","bedrock:DeleteAgent","bedrock:DeleteAgentActionGroup","bedrock:DeleteAgentAlias","bedrock:DisassociateAgentKnowledgeBase","bedrock:GetAgent","bedrock:GetAgentActionGroup","bedrock:GetAgentAlias","bedrock:GetAgentKnowledgeBase","bedrock:GetFoundationModel","bedrock:GetIngestionJob","bedrock:InvokeAgent","bedrock:InvokeModel","bedrock:InvokeModelWithResponseStream","bedrock:ListAgentActionGroups","bedrock:ListAgentAliases","bedrock:ListAgentKnowledgeBases","bedrock:ListAgents","bedrock:ListFoundationModels","bedrock:ListIngestionJobs","bedrock:PrepareAgent","bedrock:StartIngestionJob","bedrock:UpdateAgent","bedrock:UpdateAgentActionGroup","bedrock:UpdateAgentAlias","bedrock:UpdateAgentKnowledgeBase","lambda:InvokeFunction"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"BedrockAgentRoleDefaultPolicy1462CD5B","roles":[{"Ref":"BedrockAgentRole7C982E0C"}]}}}}}}},"VehicleSymptomSpecialist":{"id":"VehicleSymptomSpecialist","path":"VistaServiceStack/VehicleSymptomSpecialist","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"VehicleSymptomSpecialistAgent":{"id":"VehicleSymptomSpecialistAgent","path":"VistaServiceStack/VehicleSymptomSpecialist/VehicleSymptomSpecialistAgent","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgent","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::Agent","aws:cdk:cloudformation:props":{"agentName":"SAM-agent-analyze_vehiclesymptom","agentResourceRoleArn":{"Fn::GetAtt":["BedrockAgentRole7C982E0C","Arn"]},"description":"Analyze vehicle symptom and recommend an action / next steps based on severity","foundationModel":"anthropic.claude-3-haiku-20240307-v1:0","idleSessionTtlInSeconds":1800,"instruction":"As an agent analyze the following vehicle symptom issue by reviewing vehicle manuals, recall data\nPlease provide:\n1. Potential issues\n2. Recommended diagnostic steps\n3. Possible parts that might need replacement\n4. Estimated severity (low/medium/high)\nSummarize a detailed response in 200 words with possible next steps to address it."}}},"SAM-agent-analyze_vehiclesymptomAlias":{"id":"SAM-agent-analyze_vehiclesymptomAlias","path":"VistaServiceStack/VehicleSymptomSpecialist/SAM-agent-analyze_vehiclesymptomAlias","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgentAlias","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::AgentAlias","aws:cdk:cloudformation:props":{"agentAliasName":"analyze-vehiclesymptom-alias","agentId":{"Fn::GetAtt":["VehicleSymptomSpecialistVehicleSymptomSpecialistAgentC00F9A03","AgentId"]}}}}}},"FindNearestDealershipSpecialist":{"id":"FindNearestDealershipSpecialist","path":"VistaServiceStack/FindNearestDealershipSpecialist","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"FindNearestDealershipSpecialistAgent":{"id":"FindNearestDealershipSpecialistAgent","path":"VistaServiceStack/FindNearestDealershipSpecialist/FindNearestDealershipSpecialistAgent","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgent","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::Agent","aws:cdk:cloudformation:props":{"actionGroups":[{"actionGroupName":"action_group_findnearestdealership","actionGroupExecutor":{"lambda":{"Fn::GetAtt":["BusinessLogicGetDealerDataFunction103CF50F","Arn"]}},"description":"Find nearest dealership based on city details","functionSchema":{"functions":[{"name":"function-getdealerdata","description":"Invoke dealerdata function by passing input parameters","parameters":{"city":{"description":"name of the city","required":false,"type":"string"}}}]}}],"agentName":"SAM-agent-find-nearestdealership","agentResourceRoleArn":{"Fn::GetAtt":["BedrockAgentRole7C982E0C","Arn"]},"description":"Find nearest automotive dealership","foundationModel":"anthropic.claude-3-haiku-20240307-v1:0","idleSessionTtlInSeconds":1800,"instruction":"As an agent find nearest automotive dealership based on city. As part of response return dealer name and details"}}},"SAM-agent-find-nearestdealershipAlias":{"id":"SAM-agent-find-nearestdealershipAlias","path":"VistaServiceStack/FindNearestDealershipSpecialist/SAM-agent-find-nearestdealershipAlias","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgentAlias","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::AgentAlias","aws:cdk:cloudformation:props":{"agentAliasName":"find-nearestdealership-alias","agentId":{"Fn::GetAtt":["FindNearestDealershipSpecialistFindNearestDealershipSpecialistAgentE78BC5C0","AgentId"]}}}}}},"BookDealerApptSpecialist":{"id":"BookDealerApptSpecialist","path":"VistaServiceStack/BookDealerApptSpecialist","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"BookDealerApptSpecialistAgent":{"id":"BookDealerApptSpecialistAgent","path":"VistaServiceStack/BookDealerApptSpecialist/BookDealerApptSpecialistAgent","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgent","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::Agent","aws:cdk:cloudformation:props":{"actionGroups":[{"actionGroupName":"action_group_dealerappt-starformat","actionGroupExecutor":{"lambda":{"Fn::GetAtt":["BusinessLogicBookappointmentstarFunctionA09CBBE9","Arn"]}},"description":"This agent helps to book an appointment with an dealership.","functionSchema":{"functions":[{"name":"action-dealerapptfunction","description":"Book appt with dealership","parameters":{"appointment_time":{"description":"appointment time","required":false,"type":"string"},"dealer_name":{"description":"dealer name","required":false,"type":"string"},"appointment_date":{"description":"appointment date","required":false,"type":"string"},"customer_code":{"description":"customer code","required":false,"type":"string"}}}]}}],"agentName":"SAM-agent-bookdealerappt","agentResourceRoleArn":{"Fn::GetAtt":["BedrockAgentRole7C982E0C","Arn"]},"description":"Customer books appointment with the selected dealership to analyze vehicle symptom","foundationModel":"anthropic.claude-3-haiku-20240307-v1:0","idleSessionTtlInSeconds":1800,"instruction":"This agent helps to book an appointment with an dealership. First extract the dealer code, customer code, appointment date and appointment time from the prompt and invoke the action. Based on appointment availability it return back a star compliant schema with additional data points back as part of response."}}},"SAM-agent-bookdealerapptAlias":{"id":"SAM-agent-bookdealerapptAlias","path":"VistaServiceStack/BookDealerApptSpecialist/SAM-agent-bookdealerapptAlias","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgentAlias","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::AgentAlias","aws:cdk:cloudformation:props":{"agentAliasName":"bookdealerappt-alias","agentId":{"Fn::GetAtt":["BookDealerApptSpecialistBookDealerApptSpecialistAgent04C69A28","AgentId"]}}}}}},"FindDealerAvailabilitySpecialist":{"id":"FindDealerAvailabilitySpecialist","path":"VistaServiceStack/FindDealerAvailabilitySpecialist","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"FindDealerAvailabilitySpecialistAgent":{"id":"FindDealerAvailabilitySpecialistAgent","path":"VistaServiceStack/FindDealerAvailabilitySpecialist/FindDealerAvailabilitySpecialistAgent","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgent","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::Agent","aws:cdk:cloudformation:props":{"actionGroups":[{"actionGroupName":"action_group_finddealerslots","actionGroupExecutor":{"lambda":{"Fn::GetAtt":["BusinessLogicGetDealerAppointmentSlotsFunction27BA81DF","Arn"]}},"description":"find dealer appointment slots by invoking the lambda function","functionSchema":{"functions":[{"name":"action_groupfunc_finddealerslots","description":"Find available appointment slots for a dealer. Input dealer name (required), appointment date (optional in YYYY-MM-DD format, e.g., 2025-06-18 for June 18, 2025)","parameters":{"dealer_name":{"description":"Name of the dealer/dealership (required)","required":true,"type":"string"},"appointment_date":{"description":"Appointment date in YYYY-MM-DD format (optional). For June 18, 2025 use '2025-06-18'. If not provided, shows next available slots.","required":false,"type":"string"}}}]}}],"agentName":"SAM-agent-finddealeravailability","agentResourceRoleArn":{"Fn::GetAtt":["BedrockAgentRole7C982E0C","Arn"]},"description":"Find dealership availability that will help customer to book appt","foundationModel":"anthropic.claude-3-haiku-20240307-v1:0","idleSessionTtlInSeconds":1800,"instruction":"As an agent, check available appointment slots for customers to book appointments to bring their vehicle for analysis. \n\nIMPORTANT: Today's date is 2025-07-17 (July 17, 2025). When customers mention dates like \"June 18, 2025\" or \"June 18th\", always use the year 2025 or later.\n\nCustomer provides:\n- Dealer name (required)\n- Date (optional) - if not provided, show next available slots starting from tomorrow\n- Time (optional)\n\nWhen processing dates:\n- Always interpret relative dates like \"June 18\" as the next occurrence (2025 or later)\n- Use format YYYY-MM-DD when calling the function\n- For \"June 18, 2025\" use \"2025-06-18\"\n\nReturn available appointment slots to help customers select and book appointments."}}},"SAM-agent-finddealeravailabilityAlias":{"id":"SAM-agent-finddealeravailabilityAlias","path":"VistaServiceStack/FindDealerAvailabilitySpecialist/SAM-agent-finddealeravailabilityAlias","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgentAlias","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::AgentAlias","aws:cdk:cloudformation:props":{"agentAliasName":"finddealeravailability-alias","agentId":{"Fn::GetAtt":["FindDealerAvailabilitySpecialistFindDealerAvailabilitySpecialistAgent288F8F8A","AgentId"]}}}}}},"PartsAvailabilitySpecialist":{"id":"PartsAvailabilitySpecialist","path":"VistaServiceStack/PartsAvailabilitySpecialist","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"PartsAvailabilitySpecialistAgent":{"id":"PartsAvailabilitySpecialistAgent","path":"VistaServiceStack/PartsAvailabilitySpecialist/PartsAvailabilitySpecialistAgent","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgent","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::Agent","aws:cdk:cloudformation:props":{"actionGroups":[{"actionGroupName":"action_group_findpartsforDTC","actionGroupExecutor":{"lambda":{"Fn::GetAtt":["BusinessLogicGetPartsForDtcFunction2184BE34","Arn"]}},"description":"Find DTC to parts mapping","functionSchema":{"functions":[{"name":"function_dtctoparts","description":"Find automotive parts for this diagnostic trouble code a.ka. DTC","parameters":{"dtc_code":{"description":"dtc code","required":false,"type":"string"}}}]}},{"actionGroupName":"action_group_checkdealerstock","actionGroupExecutor":{"lambda":{"Fn::GetAtt":["BusinessLogicGetDealerStockFunctionF226E87C","Arn"]}},"description":"Check dealer inventory on parts","functionSchema":{"functions":[{"name":"action_group_dealerstock","description":"Check dealer inventory for parts availability","parameters":{"dealer_code":{"description":"Dealer name or code","required":false,"type":"string"},"part_code":{"description":"Parts code","required":false,"type":"string"}}}]}},{"actionGroupName":"action_group_orderparts","actionGroupExecutor":{"lambda":{"Fn::GetAtt":["BusinessLogicPlacePartsOrderFunction75A648BD","Arn"]}},"description":"Order parts to refill stock","functionSchema":{"functions":[{"name":"function-orderparts","description":"Order parts based on parts code and quantity","parameters":{"dealer_code":{"description":"Dealer name or code","required":false,"type":"string"},"quantity":{"description":"Quantity","required":false,"type":"string"},"part_code":{"description":"part code","required":false,"type":"string"}}}]}}],"agentName":"SAM-agent-parts-availability","agentResourceRoleArn":{"Fn::GetAtt":["BedrockAgentRole7C982E0C","Arn"]},"description":"Check for available parts based on DTC","foundationModel":"anthropic.claude-3-haiku-20240307-v1:0","idleSessionTtlInSeconds":1800,"instruction":"As parts availability agent do the following\na) Find parts for the vehicle DTC\nb) Using the parts information, check the dealership inventory for parts stock availability and show them\nc) In addition, If the inventory is zero place parts order. \nThis will help dealership for fast vehicle turn around to customer once the vehicle is at the dealership"}}},"SAM-agent-parts-availabilityAlias":{"id":"SAM-agent-parts-availabilityAlias","path":"VistaServiceStack/PartsAvailabilitySpecialist/SAM-agent-parts-availabilityAlias","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgentAlias","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::AgentAlias","aws:cdk:cloudformation:props":{"agentAliasName":"parts-availability-alias","agentId":{"Fn::GetAtt":["PartsAvailabilitySpecialistPartsAvailabilitySpecialistAgent35419E21","AgentId"]}}}}}},"WarrantyAndRecallsSpecialist":{"id":"WarrantyAndRecallsSpecialist","path":"VistaServiceStack/WarrantyAndRecallsSpecialist","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"WarrantyAndRecallsSpecialistAgent":{"id":"WarrantyAndRecallsSpecialistAgent","path":"VistaServiceStack/WarrantyAndRecallsSpecialist/WarrantyAndRecallsSpecialistAgent","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgent","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::Agent","aws:cdk:cloudformation:props":{"actionGroups":[{"actionGroupName":"action_group_vehiclewarranty","actionGroupExecutor":{"lambda":{"Fn::GetAtt":["BusinessLogicGetwarrantydataFunction33B1D1A8","Arn"]}},"description":"vehicle warranty function","functionSchema":{"functions":[{"name":"get-warranty-info","description":"vehicle warranty function","parameters":{"VIN":{"description":"vehicle identification number","required":false,"type":"string"}}}]}}],"agentName":"SAM-agent-warrantyandrecalls","agentResourceRoleArn":{"Fn::GetAtt":["BedrockAgentRole7C982E0C","Arn"]},"description":"Agent on warranties and recalls","foundationModel":"anthropic.claude-3-haiku-20240307-v1:0","idleSessionTtlInSeconds":1800,"instruction":"As an agent use the action group to find out the warranty information for a vehicle based on VIN."}}},"SAM-agent-warrantyandrecallsAlias":{"id":"SAM-agent-warrantyandrecallsAlias","path":"VistaServiceStack/WarrantyAndRecallsSpecialist/SAM-agent-warrantyandrecallsAlias","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgentAlias","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::AgentAlias","aws:cdk:cloudformation:props":{"agentAliasName":"warrantyandrecalls-alias","agentId":{"Fn::GetAtt":["WarrantyAndRecallsSpecialistWarrantyAndRecallsSpecialistAgent9DBB3A81","AgentId"]}}}}}},"VistaSupervisor":{"id":"VistaSupervisor","path":"VistaServiceStack/VistaSupervisor","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"VistaSupervisorAgent":{"id":"VistaSupervisorAgent","path":"VistaServiceStack/VistaSupervisor/VistaSupervisorAgent","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgent","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::Agent","aws:cdk:cloudformation:props":{"agentName":"SAM-agent-orchestrater","agentResourceRoleArn":{"Fn::GetAtt":["BedrockAgentRole7C982E0C","Arn"]},"description":"Multiagent service agent orchestration with end to end flow","foundationModel":"anthropic.claude-3-haiku-20240307-v1:0","idleSessionTtlInSeconds":1800,"instruction":"You are a vehicle service management assistant with two modes:\n\n1. **Service Mode**: For vehicle-specific queries\n - Invoke appropriate actions\n - Access service databases\n - Schedule appointments\n\n2. **Conversation Mode**: For general queries\n - Respond conversationally without invoking actions\n - Provide friendly greetings\n - Explain capabilities\n - Give general advice\n\nDetermine the mode based on the query:\n- \"Hello\"  Conversation Mode\n- \"Find a dealer\"  Service Mode\n- \"What can you do?\"  Conversation Mode\n- \"Schedule service\"  Service Mode\n\nIn Conversation Mode, simply respond directly without trying to invoke any actions.\n\nIn Service Mode, analyze the following vehicle issue\nPlease provide:\n1. Potential issues\n2. Recommended diagnostic steps\n3. Estimated severity (low/medium/high)\n4. find nearest dealership by city and return both dealer name and code\n5. Find dealership availability that will help customer to book appoinment\n6. Book appointment based on customer availability\n7. Using DTC look up find the automotive part\n7) check dealer inventory for availability of parts in their internal database. \n8) If out of stock, order parts now. This will help dealership to stock parts and service customer and deliver vehicle on time with out delay\n9) Get customer details\n10)Get warranty information for the vehicle"}}},"SAM-agent-orchestraterAlias":{"id":"SAM-agent-orchestraterAlias","path":"VistaServiceStack/VistaSupervisor/SAM-agent-orchestraterAlias","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgentAlias","version":"2.206.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::AgentAlias","aws:cdk:cloudformation:props":{"agentAliasName":"orchestrater-alias","agentId":{"Fn::GetAtt":["VistaSupervisorVistaSupervisorAgent14C35B9E","AgentId"]}}}}}},"DealerLambdaArn":{"id":"DealerLambdaArn","path":"VistaServiceStack/DealerLambdaArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.206.0"}},"PartsLambdaArn":{"id":"PartsLambdaArn","path":"VistaServiceStack/PartsLambdaArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.206.0"}},"WarrantyLambdaArn":{"id":"WarrantyLambdaArn","path":"VistaServiceStack/WarrantyLambdaArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.206.0"}},"AppointmentLambdaArn":{"id":"AppointmentLambdaArn","path":"VistaServiceStack/AppointmentLambdaArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.206.0"}},"DealerAppointmentLambdaArn":{"id":"DealerAppointmentLambdaArn","path":"VistaServiceStack/DealerAppointmentLambdaArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.206.0"}},"DealerTableName":{"id":"DealerTableName","path":"VistaServiceStack/DealerTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.206.0"}},"PartsTableName":{"id":"PartsTableName","path":"VistaServiceStack/PartsTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.206.0"}},"WarrantyTableName":{"id":"WarrantyTableName","path":"VistaServiceStack/WarrantyTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.206.0"}},"AppointmentTableName":{"id":"AppointmentTableName","path":"VistaServiceStack/AppointmentTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.206.0"}},"ResourceBucketName":{"id":"ResourceBucketName","path":"VistaServiceStack/ResourceBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.206.0"}},"SupervisorAgentId":{"id":"SupervisorAgentId","path":"VistaServiceStack/SupervisorAgentId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.206.0"}},"SupervisorAgentAliasId":{"id":"SupervisorAgentAliasId","path":"VistaServiceStack/SupervisorAgentAliasId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.206.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"VistaServiceStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"VistaServiceStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.206.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"VistaServiceStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.206.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"VistaServiceStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.206.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}