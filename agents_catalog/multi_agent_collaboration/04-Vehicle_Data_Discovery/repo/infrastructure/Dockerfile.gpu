# Fleet Pipeline - GPU (x86_64) Image
# For Phase 3: InternVideo2.5 + Cosmos embeddings
FROM public.ecr.aws/docker/library/python:3.11-slim

ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get update && apt-get install -y --no-install-recommends \
    ffmpeg libsm6 libxext6 git curl && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app
RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir \
    torch torchvision --index-url https://download.pytorch.org/whl/cpu && \
    pip install --no-cache-dir \
    transformers==4.40.1 accelerate timm opencv-python-headless \
    sentence-transformers pillow numpy einops decord boto3 botocore \
    sentencepiece protobuf requests

COPY pipeline/*.py /app/

CMD ["python3", "/app/internvideo25_behavioral_analyzer.py"]
